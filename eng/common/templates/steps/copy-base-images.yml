parameters:
  additionalOptions: null
  publicProjectName: null
  continueOnError: false

steps:
- ${{ if or(eq(variables['System.TeamProject'], parameters.publicProjectName), eq(variables['Build.Reason'], 'PullRequest')) }}:
  - template: /eng/common/templates/steps/set-dry-run.yml@self
- task: AzureCLI@2
  displayName: Copy Base Images
  continueOnError: ${{ parameters.continueOnError }}
  inputs:
    azureSubscription: $(acr.serviceConnectionName)
    addSpnToEnvironment: true
    scriptType: 'bash'
    scriptLocation: 'inlineScript'
    inlineScript: |
      echo $idToken > "$(Agent.TempDirectory)/token"
      $(runImageBuilderCmd) \
        copyBaseImages \
        '$(acr.subscription)' \
        '$(acr.resourceGroup)' \
        $(dockerHubRegistryCreds) \
        $(customCopyBaseImagesArgs) \
        --repo-prefix $(mirrorRepoPrefix) \
        --registry-override '$(acr.server)' \
        --os-type 'linux' \
        --architecture '*' \
        $DRYRUNARG \
        ${{ parameters.additionalOptions }}
